CREATE TABLE EMP(
  EMPNO NUMBER(4) NOT NULL,
  ENAME VARCHAR2(10),
  JOB VARCHAR2(9),
  MGR NUMBER(4),
  HIREDATE DATE,
  SAL NUMBER(7, 2),
  COMM NUMBER(7, 2),
  DEPTNO NUMBER(2)
);

INSERT INTO EMP VALUES   (7369, 'SMITH',  'CLERK',     7902,    TO_DATE('17-12-1980', 'DD-MM-YYYY'),  800, NULL, 20);
INSERT INTO EMP VALUES   (7499, 'ALLEN',  'SALESMAN',  7698,    TO_DATE('20-02-1981', 'DD-MM-YYYY'), 1600,  300, 30);
INSERT INTO EMP VALUES   (7521, 'WARD',   'SALESMAN',  7698,    TO_DATE('22-02-1981', 'DD-MM-YYYY'), 1250,  500, 30);
INSERT INTO EMP VALUES   (7566, 'JONES',  'MANAGER',   7839,    TO_DATE('02-04-1981', 'DD-MM-YYYY'),  1500, NULL, 20);
INSERT INTO EMP VALUES   (7654, 'MARTIN', 'SALESMAN',  7698,    TO_DATE('28-09-1981', 'DD-MM-YYYY'), 1250, 1400, 30);
INSERT INTO EMP VALUES   (7698, 'BLAKE',  'MANAGER',   7839,    TO_DATE('01-05-1981', 'DD-MM-YYYY'),  2850, NULL, 30);
INSERT INTO EMP VALUES   (7782, 'CLARK',  'MANAGER',   7839,    TO_DATE('09-06-1981', 'DD-MM-YYYY'),  3000, NULL, 10);
INSERT INTO EMP VALUES   (7788, 'SCOTT',  'ANALYST',   7566,    TO_DATE('09-12-1982', 'DD-MM-YYYY'), 3000, NULL, 20);
INSERT INTO EMP VALUES   (7839, 'KING',   'PRESIDENT', NULL,    TO_DATE('17-11-1981', 'DD-MM-YYYY'), 5000, NULL, 10);
INSERT INTO EMP VALUES   (7844, 'TURNER', 'SALESMAN',  7698,    TO_DATE('08-09-1981', 'DD-MM-YYYY'),  1500, NULL, 30);
INSERT INTO EMP VALUES   (7876, 'ADAMS',  'CLERK',     7788,    TO_DATE('12-01-1983', 'DD-MM-YYYY'), 1100, NULL, 20);
INSERT INTO EMP VALUES   (7900, 'JAMES',  'CLERK',     7698,    TO_DATE('03-12-1981', 'DD-MM-YYYY'),   950, NULL, 30);
INSERT INTO EMP VALUES   (7902, 'FORD',   'ANALYST',   7566,    TO_DATE('03-12-1981', 'DD-MM-YYYY'),  3000, NULL, 20);
INSERT INTO EMP VALUES   (7934, 'MILLER', 'CLERK',     7782,    TO_DATE('23-01-1982', 'DD-MM-YYYY'), 1300, NULL, 10);

CREATE TABLE DEPT (
  DEPTNO NUMBER(2),
  DNAME VARCHAR2(14),
  LOC VARCHAR2(13) 
);

INSERT INTO DEPT VALUES (10, 'ACCOUNTING', 'NEW YORK');
INSERT INTO DEPT VALUES (20, 'RESEARCH',   'DALLAS');
INSERT INTO DEPT VALUES (30, 'SALES',      'CHICAGO');
INSERT INTO DEPT VALUES (40, 'OPERATIONS', 'BOSTON');

CREATE TABLE SALGRADE(
  GRADE NUMBER,
  LOSAL NUMBER,
  HISAL NUMBER
);

INSERT INTO SALGRADE VALUES (1,  700, 1200);
INSERT INTO SALGRADE VALUES (2, 1201, 1400);
INSERT INTO SALGRADE VALUES (3, 1401, 2000);
INSERT INTO SALGRADE VALUES (4, 2001, 3000);
INSERT INTO SALGRADE VALUES (5, 3001, 9999);

SELECT COUNT(*) FROM EMP;
SELECT COUNT(*) FROM DEPT;
SELECT COUNT(*) FROM SALGRADE;

COMMIT;

-- JOB이 MANAGER인 사람들의 평균 급여
SELECT AVG(SAL)
FROM EMP
WHERE JOB = 'MANAGER';

-- 사번, 이름, 사수의 이름
SELECT E.EMPNO, E.ENAME, E2.ENAME
FROM EMP E
INNER JOIN EMP E2 ON E.MGR = E2.EMPNO; -- 셀프조인(자가조인) 자기 자신을 조인할때

-- 사번, 이름, 부하직원의 수 출력
SELECT E.EMPNO, E.ENAME, COUNT(E2.MGR) AS CNT
FROM EMP E
INNER JOIN EMP E2 ON E.EMPNO = E2.MGR
GROUP BY E.EMPNO, E.ENAME;

SELECT E.EMPNO, E.ENAME, COUNT(E2.MGR) AS CNT
FROM EMP E
LEFT JOIN EMP E2 ON E.EMPNO = E2.MGR
GROUP BY E.EMPNO, E.ENAME;

SELECT E.EMPNO, E.ENAME, E2.CNT
FROM EMP E
INNER JOIN (
    SELECT COUNT(*) AS CNT, MGR
    FROM EMP
    GROUP BY MGR
) E2 ON E.EMPNO = E2.MGR;

SELECT E.EMPNO, E.ENAME, NVL(E2.CNT, 0) AS CNT
FROM EMP E
LEFT JOIN (
    SELECT COUNT(*) AS CNT, MGR
    FROM EMP
    GROUP BY MGR
) E2 ON E.EMPNO = E2.MGR;







SELECT * FROM EMP; -- 입사번호, 이름, 직책, 사수번호, 고용일, 월급, 상여, 부서번호
SELECT * FROM DEPT; -- 부서번호, 부서이름, 위치
SELECT * FROM SALGRADE; -- 연봉테이블 최소 ~ 최대?



